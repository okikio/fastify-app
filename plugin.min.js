"use strict";var plugin=require("fastify-plugin"),path=require("path"),fs=require("fs"),jsdom=require("jsdom"),JSDOM=jsdom.JSDOM;module.exports.render=plugin(function(o,t,e){var i=t.partial||'[data-barba="container"]',u=t.root||path.join(__dirname,"public");o.decorate("cache",{}),o.decorate("path",function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:".html";return"".concat(e?e+"/":"").concat(t.replace(r,"")).concat(r)}),o.decorateReply("partial",function(t){var e,r=o.path(t,u),a="".concat(r,"__partial__fastify"),n="",c=this;return a in o.cache?c.type("text/html").send(o.cache[a]):fs.createReadStream(r).on("data",function(t){n+=t}).on("error",function(t){c.log.error(t)}).on("close",function(){e=(e=new JSDOM(n).window.document).querySelector(i),n=e.outerHTML,o.cache[a]=n,c.type("text/html").send(n)}),c}),o.decorateReply("html",function(t){var e=o.path(t,u),r="".concat(e,"__fastify"),a="",n=this;return r in o.cache?n.type("text/html").send(o.cache[r]):fs.createReadStream(e).on("data",function(t){a+=t}).on("error",function(t){n.log.error(t)}).on("close",function(){o.cache[r]=a,n.type("text/html").send(a)}),n}),o.decorateReply("render",function(t,e){var r=o.path(t);return e?this.partial(r):this.html(r)}),e()});