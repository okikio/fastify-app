"use strict";function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);if(e)n=n.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable});t.push.apply(t,n)}return t}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};if(e%2){ownKeys(t,true).forEach(function(e){_defineProperty(r,e,t[e])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(r,Object.getOwnPropertyDescriptors(t))}else{ownKeys(t).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}}return r}function _defineProperty(e,r,t){if(r in e){Object.defineProperty(e,r,{value:t,enumerable:true,configurable:true,writable:true})}else{e[r]=t}return e}if(!("dev"in process.env))require("dotenv").config();var e=require("gulp"),u=e.src,r=e.task,t=e.series,o=e.dest,n=e.watch;var i=require("uglifyjs-webpack-plugin");var s=require("gulp-sourcemaps"),a=s.init,c=s.write;var p=require("gulp-inline-source");var l=require("webpack-stream");var f=require("gulp-string-replace");var v=require("gulp-beautify"),g=v.html,d=v.js;var m=require("child_process"),j=m.spawn;var h=require("gulp-htmlmin");var w=require("cloudinary").v2;var y=require("gulp-postcss");var b=require("gulp-uglify");var q=require("gulp-rename");var O=require("gulp-babel");var S=require("fs"),_=S.writeFile;var P=require("./config");var E=require("gulp-sass");var x=require("gulp-pug");var k=process,z=k.env;var C=P.pages,D=P.cloud_name,K=P.imageURLConfig;var R="dev"in z&&z.dev.toString()=="true";var U="staticSite"in z&&z.staticSite=="true";var A="https://res.cloudinary.com/".concat(D,"/");w.config({cloud_name:D,secure:true});var J={minifyJS:true,minifyCSS:true,removeComments:true,collapseWhitespace:true,removeEmptyAttributes:false,removeRedundantAttributes:false,processScripts:["application/ld+json"]};var L={suffix:".min"};var $={delay:500};var F="public";var N={mode:R?"development":"production",devtool:R?"inline-cheap-source-map":"source-map",output:{filename:"app.min.js"},module:{rules:[{test:/\.(js|jsx)$/,exclude:/(node_modules)/,use:"babel-loader"}]},optimization:{minimizer:[new i({test:/\.js(\?.*)?$/i})]}};var W=function W(e){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{pipes:[],dest:F};var t=arguments.length>2?arguments[2]:undefined;var n=u(e,r.opts),i=r.pipes||[],s=r.dest||F;i.forEach(function(e){n=n.pipe(e)});n=n.pipe(o(s));if(t)t();return n};var B=function B(e){var t=[];var r=JSON.stringify(e,function(e,r){if(typeof r=="function"){t.push(r.toString());return"_"}return r},4);return r.replace(/\"_\"/g,function(){return t.shift()})};var G=function G(t,n){var e=t.split(/\s+/g);return j(e[0],e.slice(1),{stdio:"inherit"}).on("data",function(e){return process.stdout.write(e)}).on("exit",function(e){var r=null;if(e){r=new Error('Command "'+t+'" exited with wrong status code "'+e+'"');r.code=e;r.cmd=t}if(n){n(r)}})};var H=function H(r,t){var e=[];var n=function n(){e.push(G(r.shift(),function(e){if(e){t(e)}else{if(r.length)n();else t(null)}}))};n();return e};r("html",function(e){for(var r in C){W("views/app.pug",{pipes:[q({basename:r,extname:".html"}),x({locals:_objectSpread({},C[r],{cloud_name:D})}),R?g({indent_size:4}):h(J),f(/\/assets\/[^\s\"\']+/g,function(e){var r=new URL("".concat(A+e).replace("/assets/",""));var t=r.searchParams;var n=r.search;var i=t.get("h");var s=t.get("w")||"auto";var u=_objectSpread({},K,{width:s,height:i});return U?(/\/raw\/[^\s\"\']+/.test(e)?"".concat(A+e.replace(n,"")):w.url(e.replace(n,""),u)).replace("/assets/",""):e})]})}e()});r("css",function(){return W("src/scss/app.scss",{pipes:[a(),E({outputStyle:R?"expanded":"compressed"}).on("error",E.logError),y(),q(L),c(".")],dest:"".concat(F,"/css")})});r("js",function(){return W("src/js/app.js",{opts:{allowEmpty:true},pipes:[l(N)],dest:"".concat(F,"/js")})});r("server",function(){return W(["*.js","!postcss.config.js","!*.min.js","!gulpfile.js","!config.js","!config-dev.js"],{opts:{allowEmpty:true},pipes:[O(),b(),q(L)],dest:"."})});r("config",function(){return _("./config.min.js","module.exports = ".concat(B(P),";"),function(e){if(e)throw e}),W("config.min.js",{opts:{allowEmpty:true},pipes:[O(),b()],dest:"."}),W("config.min.js",{opts:{allowEmpty:true},pipes:[d({indent_size:4}),q({basename:"config-dev",extname:".js"})],dest:"."})});r("config:watch",function(e){G("gulp config server html --gulpfile ./gulpfile.min.js",function(){return e()})});r("update",function(){return W("gulpfile.js",{opts:{allowEmpty:true},pipes:[O(),b(),q(L)],dest:"."})});r("gulpfile:watch",function(e){G("gulp update",function(){return e()})});r("git",function(e){var r=["git add .","git commit -m 'Upgrade'","git push -u origin master"];H(r,function(){return e()})});r("inline",function(){return W("public/*.html",{pipes:[p({compress:false})]})});r("default",t("update","config","server","html","css","js"));r("watch",function(){n(["config.js","containers/*.js"],$,t("config:watch"));n(["gulpfile.js","postcss.config.js"],$,t("gulpfile:watch","server"));n(["server.js","plugin.js"],$,t("server"));n("views/**/*.pug",$,t("html","server","css","inline"));n("src/**/*.scss",$,t("css","server","inline"));n("src/**/*.js",$,t("js","server","inline"))});
