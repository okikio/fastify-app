"use strict";function ownKeys(r,e){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),s.push.apply(s,t)}return s}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(s,!0).forEach(function(e){_defineProperty(r,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):ownKeys(s).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(s,e))})}return r}function _defineProperty(e,r,s){return r in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var r=0,s=new Array(e.length);r<e.length;r++)s[r]=e[r];return s}}require("core-js/modules/es.symbol"),require("core-js/modules/es.symbol.description"),require("core-js/modules/es.symbol.iterator"),require("core-js/modules/es.array.filter"),require("core-js/modules/es.array.flat"),require("core-js/modules/es.array.for-each"),require("core-js/modules/es.array.from"),require("core-js/modules/es.array.is-array"),require("core-js/modules/es.array.iterator"),require("core-js/modules/es.array.map"),require("core-js/modules/es.array.slice"),require("core-js/modules/es.array.unscopables.flat"),require("core-js/modules/es.date.to-string"),require("core-js/modules/es.object.define-properties"),require("core-js/modules/es.object.define-property"),require("core-js/modules/es.object.get-own-property-descriptor"),require("core-js/modules/es.object.get-own-property-descriptors"),require("core-js/modules/es.object.keys"),require("core-js/modules/es.object.to-string"),require("core-js/modules/es.object.values"),require("core-js/modules/es.promise"),require("core-js/modules/es.regexp.exec"),require("core-js/modules/es.regexp.to-string"),require("core-js/modules/es.string.iterator"),require("core-js/modules/es.string.replace"),require("core-js/modules/es.string.search"),require("core-js/modules/es.string.split"),require("core-js/modules/web.dom-collections.for-each"),require("core-js/modules/web.dom-collections.iterator"),require("core-js/modules/web.url");var _process=process,env=_process.env;"dev"in env||require("dotenv").config();var dev="dev"in env&&"true"==env.dev.toString(),gulp=require("gulp"),src=gulp.src,task=gulp.task,series=gulp.series,dest=gulp.dest,watch=gulp.watch,_require=require("./browserslist".concat(dev?"":".min")),babelConfig=_require.babelConfig,nodeResolve=require("rollup-plugin-node-resolve"),config=require("./config".concat(dev?"":".min")),_require2=require("gulp-sourcemaps"),init=_require2.init,write=_require2.write,inlineSrc=require("gulp-inline-source"),replace=require("gulp-string-replace"),_require3=require("gulp-beautify"),html=_require3.html,js=_require3.js,rollup=require("gulp-better-rollup"),_require4=require("child_process"),spawn=_require4.spawn,htmlmin=require("gulp-htmlmin"),assets=require("cloudinary").v2,postcss=require("gulp-postcss"),uglify=require("gulp-uglify"),rename=require("gulp-rename"),babel=require("gulp-babel"),_require5=require("fs"),writeFile=_require5.writeFile,sass=require("gulp-sass"),pug=require("gulp-pug"),pages=config.pages,cloud_name=config.cloud_name,imageURLConfig=config.imageURLConfig,staticSite="staticSite"in env&&"true"==env.staticSite,assetURL="https://res.cloudinary.com/".concat(cloud_name,"/");assets.config({cloud_name:cloud_name,secure:!0});var htmlMinOpts={minifyJS:!0,minifyCSS:!0,removeComments:!0,collapseWhitespace:!0,removeEmptyAttributes:!1,removeRedundantAttributes:!1,processScripts:["application/ld+json"]},minSuffix={suffix:".min"},watchDelay={delay:500},publicDest="public",stream=function(e,r,s){var t=1<arguments.length&&void 0!==r?r:{pipes:[],dest:publicDest},i=2<arguments.length?s:void 0,n=src(e,t.opts),o=t.pipes||[],a=t.dest||publicDest;return new Promise(function(e,r){o.forEach(function(e){n=n.pipe(e).on("error",r)}),n=n.pipe(dest(a)).on("end","function"==typeof i?i:e)})},streamList=function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];return Promise.all(r.map(function(e){return Array.isArray(e)?stream.apply(void 0,_toConsumableArray(e)):e}))},stringify=function(e){var s=[];return JSON.stringify(e,function(e,r){return"function"==typeof r?(s.push(r.toString()),"_"):r},4).replace(/\"_\"/g,function(){return s.shift()})},exec=function(s,t){var e=s.split(/\s+/g);return spawn(e[0],e.slice(1),{stdio:"inherit"}).on("data",function(e){return process.stdout.write(e)}).on("exit",function(e){var r=null;e&&((r=new Error('Command "'+s+'" exited with wrong status code "'+e+'"')).code=e,r.cmd=s),t&&t(r)})},execSeries=function(e){return Promise.all(e.map(function(e){return new Promise(function(r,s){exec(e,function(e){if(e)return s(e);r()})})}))};task("html",function(){var s=Object.keys(pages),e=Object.values(pages);return streamList.apply(void 0,_toConsumableArray(e.map(function(e,r){return["views/app.pug",{pipes:[rename({basename:s[r],extname:".html"}),pug({locals:_objectSpread({},e,{cloud_name:cloud_name})}),dev?html({indent_size:4}):htmlmin(htmlMinOpts),replace(/\/assets\/[^\s\"\']+/g,function(e){var r=new URL("".concat(assetURL+e).replace("/assets/","")),s=r.searchParams,t=r.search,i=s.get("h"),n=s.get("w")||"auto",o=_objectSpread({},imageURLConfig,{width:n,height:i});return staticSite?(/\/raw\/[^\s\"\']+/.test(e)?"".concat(assetURL+e.replace(t,"")):assets.url(e.replace(t,""),o)).replace("/assets/",""):e})]}]})))}),task("css",function(){return stream("src/scss/app.scss",{pipes:[init(),sass({outputStyle:dev?"expanded":"compressed"}).on("error",sass.logError),postcss(),rename(minSuffix),write("./")],dest:"".concat(publicDest,"/css")})}),task("js",function(){return streamList.apply(void 0,_toConsumableArray(["modern","general"].map(function(e){return[["src/js/app.js",{opts:{allowEmpty:!0},pipes:[init(),rollup({plugins:[nodeResolve()]},"es"),babel(babelConfig[e]),rename("app".concat("general"==e?"":"-".concat(e),".min.js")),write("./")],dest:"".concat(publicDest,"/js")}],["public/js/app".concat("general"==e?"":"-".concat(e),".min.js"),{pipes:[init({loadMaps:!0}),babel(babelConfig[e]),dev?js():uglify(),write("./")],dest:"".concat(publicDest,"/js")}]]}).flat()))}),task("server",function(){return stream(["*.js","!postcss.config.js","!*.min.js","!gulpfile.js","!config.js","!config-dev.js"],{opts:{allowEmpty:!0},pipes:[babel(babelConfig.general),uglify(),rename(minSuffix)],dest:"."})}),task("config",function(){return streamList(new Promise(function(r,s){writeFile("./config.min.js","module.exports = ".concat(stringify(config),";"),function(e){if(e)throw s(),e;r()})}),["config.min.js",{opts:{allowEmpty:!0},pipes:[babel(babelConfig.general),uglify()],dest:"."}],["config.min.js",{opts:{allowEmpty:!0},pipes:[js({indent_size:4}),rename({basename:"config-dev",extname:".js"})],dest:"."}])}),task("config:watch",function(){return exec("gulp config server html --gulpfile ./gulpfile.min.js")}),task("update",function(){return stream("gulpfile.js",{opts:{allowEmpty:!0},pipes:[babel(babelConfig.general),uglify(),rename(minSuffix)],dest:"."})}),task("gulpfile:watch",function(){return execSeries(["gulp update","gulp"])}),task("git",function(){return execSeries(["git add .","git commit -m 'Upgrade'","git push -u origin master"])}),task("inline",function(){return stream("public/*.html",{pipes:[inlineSrc({compress:!1})]})}),task("default",series("update","config","server","html","css","js","inline")),task("watch",function(){watch(["config.js","containers/*.js"],watchDelay,series("config:watch")),watch(["gulpfile.js","postcss.config.js"],watchDelay,series("gulpfile:watch","server")),watch(["server.js","plugin.js"],watchDelay,series("server")),watch("views/**/*.pug",watchDelay,series("html","server","css","inline")),watch("src/**/*.scss",watchDelay,series("css","server","inline")),watch("src/**/*.js",watchDelay,series("js","server","inline"))}),module.exports=gulp;