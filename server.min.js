"use strict";var _process=process,env=_process.env;"dev"in env||require("dotenv").config();var dev="dev"in env&&"true"==env.dev.toString(),heroku="heroku"in env&&"true"==env.heroku.toString(),compress=require("fastify-compress"),noIcon=require("fastify-no-icon"),helmet=require("fastify-helmet"),cors=require("fastify-cors"),fastify=require("fastify"),path=require("path"),_require=require("./config".concat(dev?"":".min")),routes=_require.routes,_require2=require("./plugin".concat(dev?"":".min")),_render=_require2._render,_static=_require2._static,_assets=_require2._assets,_reload=_require2._reload,normalizePort=function(e){var r=parseInt(e,10);return isNaN(r)?e:r>=0&&r},HOST=heroku?"0.0.0.0":"localhost",root=path.join(__dirname,"public"),PORT=normalizePort(process.env.PORT||3e3),reloadTime=29,maxAge=1e3*(dev?0:1)*60*60*24*7,app=fastify({logger:{prettyPrint:{translateTime:"hh:MM:ss TT"}},ignoreTrailingSlash:!0,caseSensitive:!1});app.register(compress).register(helmet).register(noIcon).register(_render,{partial:"#swup"}).register(_assets,{maxAge:maxAge}).register(_reload,{reloadTime:reloadTime}).register(cors,{methods:["GET","PUT","POST"],cacheControl:!0,maxAge:maxAge,preflightContinue:!0,preflight:!0}).register(_static,{cacheControl:!0,maxAge:maxAge,root:root});var _loop=function(e){app.get(e,function(r,t){t.header("cache-control","public, max-age=".concat(maxAge)),t.render(routes[e],r.headers["x-partial"])})};for(var i in routes)_loop(i);app.setNotFoundHandler(function(e,r){r.code(404).type(e.headers["content-type"]||"text/plain").send("A custom not found")}),app.setErrorHandler(function(e,r,t){var o=e.statusCode>=400?e.statusCode:500;r.log.warn(e),t.code(o).type(r.headers["content-type"]||"text/plain").send(o>=500?"Internal server error":e.message)}),app.listen(PORT,HOST,function(e){e&&app.log.error(e),app.log.info("Server listening on port",PORT)});